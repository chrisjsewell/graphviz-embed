# This is a Cross.toml configuration file for cross-compiling Rust projects.

# we need the latest, rather than the default stable, to use ubuntu 20.04 instead of 16.04
# (stable was released 3 years ago and is quite out of date)

# We also need to install Python 3.6+ on the aarch64-unknown-linux-gnu target before building,
# since the default cross-rs image does not include it, and some build scripts require Python.
[target.aarch64-unknown-linux-gnu]
# see https://github.com/cross-rs/cross/blob/main/docker/Dockerfile.aarch64-unknown-linux-gnu
image = "ghcr.io/cross-rs/aarch64-unknown-linux-gnu:latest"
pre-build = [
    """
    apt-get update && apt-get install -y wget xz-utils && \
    wget -qO- https://github.com/astral-sh/python-build-standalone/releases/download/20231002/cpython-3.11.6+20231002-x86_64-unknown-linux-gnu-install_only.tar.gz | tar xzf - -C /opt && \
    ln -sf /opt/python/bin/python3 /usr/bin/python3 && \
    ln -sf /opt/python/bin/python3 /usr/bin/python
    """
]
